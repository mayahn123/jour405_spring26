---
title: "HW7_CarAccidents"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Analyzing Daily Accident Data with Z-Scores

## Introduction

In this analysis, we'll examine daily accident data from Prince George's County to identify statistically unusual patterns that might lead to newsworthy stories. Z-scores provide a powerful statistical method to determine which days experienced an abnormal number of accidents compared to typical patterns.

A z-score tells us how many standard deviations a data point is from the mean. Generally:
- Z-scores between -2 and 2 represent typical values (about 95% of the data)
- Z-scores beyond ±2 indicate unusual values that might warrant investigation
- Z-scores beyond ±3 are very unusual (only about 0.3% of normally distributed data)

## Setup

Let's start by loading the necessary packages:

```{r load-packages}
library(tidyverse)  # For data manipulation and visualization
library(knitr)      # For nice tables
library(lubridate)  # For working with dates
```

### Task 1: Loading the Data (1 point)

Load the accident data from our CSV file at https://raw.githubusercontent.com/dwillis/jour405/refs/heads/main/data/daily_accidents.csv into a dataframe called `accidents`:

```{r load-data}
accidents <- read_csv("https://raw.githubusercontent.com/dwillis/jour405/refs/heads/main/data/daily_accidents.csv")
```

## Data Exploration

Let's first understand our dataset structure:

```{r data-exploration}
# Get a summary of the data
summary(accidents)

# Check how many days we have in total
nrow(accidents)

# Check the date range
min(accidents$date)
max(accidents$date)
```

Now let's create a time series visualization of accidents:

```{r time-series-plot}
# Plot time series
ggplot(accidents, aes(x = date, y = total)) +
  geom_line(alpha = 0.5) +
  geom_smooth(method = "loess", span = 0.1) +
  theme_minimal() +
  labs(title = "Daily Accidents in Prince George's County",
       x = "Date",
       y = "Number of Accidents",
       caption = "Source: Prince George's County Accident Data")
```

### Task 2 (3 points)
Looking at the time series visualization above, identify at least two noticeable patterns or anomalies. What questions would you want to investigate further based on this initial view of the data? How might these visual patterns translate into potential story angles?

The first pattern that stood out to me was the drop in car accidents in 2020. This does make sense because people were directed to stay at home during the COVID-19 pandemic, which meant less people were driving. I think it could be interesting to examine if there are any other factors do the drop in accidents, or if it was primarily because less people were on the road. I also think it could be interesting to see if the number of accidents in 2020 were proportional to the average number of cars on the road, compared to other years. 

Another pattern I noticed is that the number of car accidents was trending down at the end of 2024. I would first check if this trend continued into 2025 and 2026 to see if the topic is still relevant to examine. I would also see if there are any changes in how traffic violations are enforced in the county to see if there is a reason for the drop in accidents. 

The daily data is quite noisy, so let's also look at weekly patterns:

```{r weekly-patterns}
# Add day of week 
accidents <- accidents |>
  mutate(
    day_of_week = wday(date, label = TRUE),
    month = floor_date(date, "month"),
    year = year(date)
  )

# Check accident patterns by day of week
day_of_week_summary <- accidents |>
  group_by(day_of_week) |>
  summarize(
    avg_accidents = mean(total),
    median_accidents = median(total),
    max_accidents = max(total),
    min_accidents = min(total)
  )

# Display day of week summary
day_of_week_summary |> kable(digits = 2)

# Visualize by day of week
ggplot(accidents, aes(x = day_of_week, y = total)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Accident Distribution by Day of Week",
       x = "Day of Week",
       y = "Number of Accidents",
       caption = "Source: Prince George's County Accident Data")
```

### Task 3 (2 points)
Based on the day-of-week analysis, which day(s) have the highest and lowest average accidents? Why might these patterns exist?

The day of the week analysis shows that Fridays have the highest average number of accidents, with about 28 accidents. I think this could be because people are often rushing to leave work before the weekend and may drive unsafely. Additionally, people often have plans on Friday nights, which means more people are on the road in the dark. It looks like Mondays, Tuesdays and Wednesdays have the lowest average number of accidents, with about 24 accidents. This could be because people are often driving to work and are doing things that are part of their typical routine. Because of this, people may be more likely to drive in areas they are familiar with and are able to drive with less mistakes. 

## Calculating Z-Scores

### Task 4 (2 points)

Now, using the accidents dataframe, add three columns using `mutate()`: mean_accidents, sd_accidents and z_score, based on the example from class.

```{r calculate-z-scores}
# Calculate z-scores for total accidents
accidents <- accidents |>
  mutate(
    mean_accidents = mean(total),
    sd_accidents = sd(total),
    z_score = (total - mean_accidents) / sd_accidents
  )


# Display the data with z-scores
accidents |>
  select(date, day_of_week, total, z_score) |>
  head(10) |>
  kable(digits = 2)
```

## Identifying Unusual Days

Let's identify days with unusually high or low accident numbers (|z-score| > 2):

```{r unusual-days}
# Find days with unusual accident numbers
unusual_days <- accidents |>
  filter(abs(z_score) > 2) |>
  arrange(desc(abs(z_score)))

# Display number of unusual days
cat("Number of days with unusual accident counts:", nrow(unusual_days), 
    "out of", nrow(accidents), "total days (", 
    round(nrow(unusual_days)/nrow(accidents)*100, 2), "%)")

# Display the top 10 most unusual days
unusual_days |>
  head(10) |>
  select(date, day_of_week, total, z_score) |>
  kable(digits = 2)
```

### Task 5 (3 points)
Choose one of the top 10 unusual days and research what might have happened on that date. Look for weather events, holidays, major incidents, or other factors that could explain the unusual number of accidents. Briefly describe your findings and how you would incorporate this context into a story.

The date with the most usual number of car accidents was Oct. 29, 2021, with a z-score of 4.77. There were 58 accidents on this day. I found that there was a severe storm on this day, which definitely contributed to the number of car accidents. In a story about this, I would make sure to include information about the storm's conditions, such as how it caused severe flooding and strong winds. 

Let's visualize these unusual days:

```{r plot-unusual-days}
# Highlight unusual days in the time series
ggplot(accidents, aes(x = date, y = total, color = abs(z_score) > 2)) +
  geom_point(alpha = 0.5) +
  scale_color_manual(values = c("gray", "red"), 
                     name = "Unusual Value",
                     labels = c("Normal", "Unusual")) +
  theme_minimal() +
  labs(title = "Daily Accidents with Unusual Days Highlighted",
       subtitle = "Unusual days have z-scores with absolute values > 2",
       x = "Date",
       y = "Number of Accidents",
       caption = "Source: Prince George's County Accident Data")
```

## Day of Week Patterns

### Task 6 (3 points)

Let's calculate z-scores that account for day of week patterns based on the same pattern as above:

```{r day-of-week-z-scores}
# Calculate day-of-week adjusted z-scores
accidents <- accidents |>
  group_by(day_of_week) |>
  mutate(
    dow_mean = mean(total),
    dow_sd = sd(total),
    dow_z_score = (total - dow_mean) / dow_sd
  ) |>
  ungroup()

# Find days with unusual day-of-week z-scores
unusual_dow <- accidents |>
  filter(abs(dow_z_score) > 2) |>
  arrange(desc(abs(dow_z_score)))

# Display the top unusual days adjusted for day of week
unusual_dow |>
  head(10) |>
  select(date, day_of_week, total, dow_mean, dow_z_score) |>
  kable(digits = 2)
```

### Task 7 (3 points)
Compare the days that have extreme z-scores overall versus those with extreme day-of-week z-scores. How do these lists differ? What journalistic insights can you draw from comparing these two different approaches to measuring "unusual" days?

For this dataset, some of the day-of-week z-scores changed slightly because they took into account the number of accidents that typically occur on that day. For example, the Oct. 29, 2021 z-score went down slightly because there are typically more car accidents on Friday. While the number of accidents is abnormal, there are always more car accidents on Fridays, so it is not as much of an outlier for that day. The overall z-scores highlight outliers within the entire data set, while the day-of-week z-scores see if the data is abnormal for a certain day. Because of this, comparing the overall z-score can provide information about major events, like storms or holidays, while the day-of-week examines changes in weekly trends.  

Let's see how many unusual days we have for each day of the week:

```{r unusual-by-dow}
# Count unusual days by day of week
unusual_count_by_dow <- accidents |>
  filter(abs(dow_z_score) > 2) |>
  count(day_of_week) |>
  arrange(desc(n))

# Get total count by day of week for comparison
total_by_dow <- accidents |>
  count(day_of_week)

# Join to calculate percentages
unusual_rates <- unusual_count_by_dow |>
  left_join(total_by_dow, by = "day_of_week") |>
  rename(unusual_days = n.x, total_days = n.y) |>
  mutate(
    pct_unusual = (unusual_days / total_days) * 100
  )

# Display results
unusual_rates |> kable(digits = 2)
```

## Monthly Patterns

Let's examine if certain months have more unusual days:

```{r monthly-patterns}
# Extract month from date for seasonal analysis
accidents <- accidents |>
  mutate(month_of_year = month(date, label = TRUE))

# Calculate average accidents by month
monthly_pattern <- accidents |>
  group_by(month_of_year) |>
  summarize(
    avg_accidents = mean(total),
    median_accidents = median(total)
  )

# Plot monthly pattern
ggplot(monthly_pattern, aes(x = month_of_year, y = avg_accidents, group = 1)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Average Daily Accidents by Month",
       x = "Month",
       y = "Average Number of Accidents",
       caption = "Source: Prince George's County Accident Data")

# Calculate month-adjusted z-scores
accidents <- accidents |>
  group_by(month_of_year) |>
  mutate(
    monthly_mean = mean(total),
    monthly_sd = sd(total),
    monthly_z_score = (total - monthly_mean) / monthly_sd
  ) |>
  ungroup()

# Find days with unusual monthly z-scores
unusual_monthly <- accidents |>
  filter(abs(monthly_z_score) > 2) |>
  arrange(desc(abs(monthly_z_score)))

# Display top days that are unusual for their month
unusual_monthly |>
  head(10) |>
  select(date, month_of_year, day_of_week, total, monthly_mean, monthly_z_score) |>
  kable(digits = 2)
```

### Task 8 (2 points)
Based on the monthly pattern analysis, which months have the highest and lowest average accidents? Develop a hypothesis about why these seasonal patterns exist.

January has the lowest average number of car accidents, while October has the highest average number of car accidents. This could be because in October, the weather is starting to become more rainy and cold, which can cause more accidents if drivers are not used to that weather. While Janruary is a very cold and icy month, the weather may deter people from driving, which could be why there are less accidents during the month. 

## Identifying Extreme Outliers

Let's look specifically at days with extremely unusual accident counts (z-scores beyond ±3):

```{r extreme-outliers}
# Find extreme outliers
extreme_outliers <- accidents |>
  filter(abs(z_score) > 3) |>
  arrange(desc(abs(z_score)))

# Display extreme outliers
if(nrow(extreme_outliers) > 0) {
  extreme_outliers |>
    select(date, day_of_week, total, z_score) |>
    kable(digits = 2)
} else {
  cat("No days with z-scores beyond ±3 were found in the dataset.")
}
```

### Task 9 (2 points)
For the extreme outliers identified (z-scores beyond ±3), what do they have in common?

I found that all of the days with extreme positive outliers had some sort of rainy weather. While some of the weather conditions were more severe, it looks like it likely would have contributed to the high number of car accidents. 

## Your Best Story Pitch

### Task 10 (5 points)
Based on all the analyses performed, craft your best story pitch, including a headline and lede. Be sure to include what kinds of sources/people you'd talk to for the story.

I would write a story about how the county has the greatest number of car accidents on days when it rains. I would include information about the higher number of accidents and what drivers should know about driving in the rain. For the story, I would talk to the police department and other first responders to see how they respond to and prepare for car accidents during weather events. I could also speak to someone who works with cars to discuss how to make sure a car is suited to drive in rainy weather. 

Headline: Prince George's County sees spike in car accidents on rainy days
Lede: Prince George's County drivers got into significantly more car accidents on days when it rained, county data shows. 
